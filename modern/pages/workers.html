<div class="container mt-4">
    {{ function capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)} }}
    {{ for(var pool in it.stats.pools) { }}
        {{ if (it.stats.pools[pool].minerCount > 0) { }}
        <div class="card mb-4">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        {{=capitalizeFirstLetter(it.stats.pools[pool].name)}} Top Miners
                        <small class="ml-3">
                            <i class="fa fa-users"></i> <span id="statsMiners{{=pool}}">{{=it.stats.pools[pool].minerCount}}</span> Miners &nbsp;&nbsp;
                            <i class="fa fa-rocket"></i> <span id="statsWorkers{{=pool}}">{{=it.stats.pools[pool].workerCount}}</span> Workers &nbsp;&nbsp;
                            <i class="fa fa-cog"></i> <span>{{? typeof it.stats.pools[pool].shareCount !== 'undefined' && it.stats.pools[pool].shareCount !== null}} {{=Math.floor(it.stats.pools[pool].shareCount)}} {{??}} 0 {{?}}</span> Shares
                        </small>
                    </div>
                    <div class="form-inline">
                        <input type="text" class="form-control mr-2" placeholder="Miner Lookup" id="miner-lookup-{{=pool}}">
                        <button class="btn btn-primary" type="button" onclick="lookupMiner('{{=pool}}')">Lookup</button>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead class="thead-dark">
                            <tr>
                                <th>Address</th>
                                <th>Shares</th>
                                <th>Efficiency</th>
                                <th>Hashrate</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{ for(var worker in it.stats.pools[pool].miners) { }}
                                {{var workerstat = it.stats.pools[pool].miners[worker];}}
                                <tr>
                                    <td><a href="/workers/{{=worker.split('.')[0]}}">{{=worker}}</a></td>
                                    <td>{{? typeof workerstat.currRoundShares !== 'undefined' && workerstat.currRoundShares !== null}} {{=Math.floor(workerstat.currRoundShares)}} {{??}} 0 {{?}}</td>
                                    <td>{{? workerstat.shares > 0}} {{=Math.floor(10000 * workerstat.shares / (workerstat.shares + workerstat.invalidshares)) / 100}}% {{??}} 0% {{?}}</td>
                                    <td>{{=workerstat.hashrateString}}</td>
                                </tr>
                            {{ } }}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {{ } }}
    {{ } }}
</div>

<script type="text/javascript">
    function lookupMiner(pool) {
        var address = $('#miner-lookup-' + pool).val();
        if (address) {
            window.location = "/workers/" + address;
        }
    }
    
    $(document).ready(function(){
        $('input[id^="miner-lookup-"]').on('keypress', function(e) {
            if (e.which === 13) {
                var pool = $(this).attr('id').split('-')[2];
                lookupMiner(pool);
            }
        });
    });
</script>
